<div id="content-wrapper" class="d-flex flex-column">

  <!-- Main Content -->
  <div id="content">

    <!-- Topbar -->
    <nav class="navbar navbar-expand-md navbar-light bg-white topar mb-4 static-top shadow">

      <!-- Sidebar Toggle (Topbar) -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#accionesbar">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Topbar Search -->
      <!-- Topbar Navbar -->
      <div class="collapse navbar-collapse" id="accionesbar">
        <ul class="navbar-nav mx-auto">

          <li class="nav-item">
            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#reg-user">
              <i class="fa fa-plus fa-fw"></i> Registrar usuario
            </button>
          </li>
          <!-- Nav Item - Search Dropdown (Visible Only XS) -->
          <!-- Nav Item - Alerts -->
          <!-- Nav Item - Messages -->
          <!-- Nav Item - User Information -->


        </ul>
      </div>

    </nav>
    <!-- End of Topbar -->


    <div class="container-fluid mb-3">

      <div class="row">

        <div class="col-lg-2"></div>

        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body">


              <table class="table display responsive" id="usuarios">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Puesto</th>
                    <th>Acciones</th>
                  </tr>

                </thead>
                <tbody>
                  <tr *ngFor="let user of this.usersService.user">
                    <td>{{user.name}}</td>
                    <td>
                      <label *ngIf="user.userType==1">Gerente</label>
                      <label *ngIf="user.userType==2">Residente</label>
                      <label *ngIf="user.userType==3">Proyectista</label>
                    </td>
                    <td>
                      <div class="btn-group float-right">
                        <!--button class="btn  btn-secondary">
                          <i class="fas fa-eye"></i>
                        </button-->
                        <button (click)="SelectedUser(user.name,user._id,user.email,user.mobile,user.password)" class="btn btn-warning" data-toggle="modal"
                          data-target="#edit-user">
                          <i class="fas fa-pen"></i>
                        </button>

                        <button *ngIf="user.projects.length==0"class="btn btn-danger" type="button" (click)="deleteUser(user._id)">
                            <i class="fas fa-trash"></i>
                        </button>

                       
                      </div>

                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
      <!--Aqui va el contenido-->
    </div>
    <!-- /.container-fluid -->

  </div>
  <!-- End of Main Content -->


</div>
<!-- End of Content Wrapper -->

<!--Modal de creacion-->
<div class="modal fade" id="reg-user" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="exampleModalLabel">Registro de usuario</h5>
        <button class="close text-white" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form #userForm="ngForm" (ngSubmit)="addUser(userForm)">
        <div class="modal-body">
          <div class="container-fluid">

            <div class="row">
              <div class="col-lg-1">
                <i class="fas fa-user text-success fa-2x float-right"></i>
              </div>
              <div class="col-lg-6">
                <div class="form-group">
                  <input type="text" placeholder="Nombre" class="form-control" name="name" [(ngModel)]="name" #nameref="ngModel" maxlength="100"
                    required pattern="[A-Za-záéíóúÁÉÍÓÚ ]{0,100}">
                </div>
              </div>
              <div class="col-lg-5">
                <div class="form-group">
                  <input type="text" placeholder="Apellido" class="form-control" [(ngModel)]="lastname" name="lastname" #lastnameref="ngModel"
                    maxlength="100" required pattern="[A-Za-záéíóúÁÉÍÓÚ ]{0,100}">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-1">
                <i class="fas fa-envelope text-success fa-2x float-right"></i>
              </div>
              <div class="col-lg-11">
                <div class="form-group">
                  <input type="text" placeholder="Correo Electronico" class="form-control" [(ngModel)]="email" name="email" #emailref="ngModel"
                    maxlength="100" required pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[a-z]{2,3}$">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-1">
                <i class="fas fa-phone text-success fa-2x float-right"></i>
              </div>
              <div class="col-lg-11">
                <div class="form-group">
                  <input type="text" placeholder="movil" class="form-control" [(ngModel)]="mobile" name="mobile" #mobileref="ngModel" maxlength="100"
                    required pattern="[0-9]{10,14}$">
                </div>
              </div>
            </div>


            <div class="row mb-3">
              <div class="col-lg-1">
                <i class="fas fa-key text-success fa-2x float-right"></i>
              </div>
              <!--div class="col-lg-1"></div-->
              <div class="col-lg-6">
                <div class="form-group">
                  <input type="text" placeholder="Contraseña" class="form-control" [(ngModel)]="password" name="password" #passwordref="ngModel"
                    required (keyup)="checkPasses()" pattern="[A-Za-z0-9|°¬!'#$%&/()=?\¡¿´¨+*~`^,;.:-_@áéíóúÁÉÍÓÚ]{8,30}">
                </div>
              </div>
              <div class="col-lg-5">
                <div class="form-group">
                  <input type="text" placeholder="Repetir contraseña" class="form-control" [(ngModel)]="reppassword" name="reppassword" #reppaswordref="ngModel"
                    required (keyup)="checkPasses()" pattern="[A-Za-z0-9|°¬!'#$%&/()=?\¡¿´¨+*~`^,;.:-_@áéíóúÁÉÍÓÚ]{8,30}">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-1">
                <i class="fas fa-users text-success fa-2x float-right"></i>
              </div>
              <div class="col-lg-11 mt-2">
                <div class="form-group">
                  <h6>Tipo de usuario: </h6>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-1"></div>
              <div class="col-lg-5 my-2">
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" value="2" [(ngModel)]="userType" name="userType">
                  <label class="form-check-label" for="res-opt">Residente</label>
                </div>
              </div>
              <div class="col-lg-5 my-2">
                <div class="form-check form-check-inline">
                  <input type="radio" class="form-check-input" value="3" [(ngModel)]="userType" name="userType">
                  <label class="form-check-label" for="res-opt">Proyectista</label>
                </div>
              </div>
            </div>



          </div>
        </div>



        <div class="modal-footer">
          <div [hidden]="!nameref.errors?.pattern">
            En el nombre solo puede haber letras.
          </div>
          <div [hidden]="!lastnameref.errors?.pattern">
            En los apellidos solo pueden haber letras.
          </div>
          <div [hidden]="!emailref.errors?.pattern">
            Correo Invalido.
          </div>
          <div [hidden]="!mobileref.errors?.pattern">
            El numero debe de tener minimo 10 y maximo 14 caracteres.
          </div>
          <div [hidden]="!passwordref.errors?.pattern">
            La contraseña debe de tener minimo 8 y maximo 30 caracteres, sin espacios.
          </div>
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancelar</button>
          <input [hidden]="emailref.errors?.pattern || mobileref.errors?.pattern || nameref.errors?.pattern || passwordref.errors?.pattern || lastnameref.errors?.pattern"
            type="submit" class="btn btn-success" value="Registrar" [disabled]="boton">
        </div>
      </form>
    </div>
  </div>
</div>
<swal #usercorrect title="Usuario guardado exitosamente" type="success" [focusCancel]="true">

</swal>
<swal #userincorrect title="Favor de completar todos los campos" type="warning" [focusCancel]="true">

</swal>

<!--Modal de editado-->
<div class="modal fade" id="edit-user" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header bg-warning text-white">
        <h5 class="modal-title" id="exampleModalLabel">Editando usuario...</h5>
        <button class="close text-white" type="button" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <form #updateForm="ngForm" (ngSubmit)="updateUser(updateForm)" (keydown.enter)="$event.preventDefault()">
        <div class="modal-body">
          <div class="container-fluid">
            <div class="form-group">
              <input type="hidden" name="id2" [(ngModel)]="id2">
            </div>
            <div class="row">
              <!--div class="col-lg-1">
              <i class="fas fa-user text-warning fa-2x float-right"></i>
            </div>
            <div class="col-lg-11">
              <div class="form-group">
                <input type="text" placeholder="Nombre" class="form-control">
              </div>
            </div>
            <div class="col-lg-5">
              <div class="form-group">
                <input type="text" placeholder="Apellido" class="form-control">
              </div>
            </div-->
            </div>

            <div class="row">
              <div class="col-lg-1">
                <i class="fas fa-envelope text-warning fa-2x float-right"></i>
              </div>
              <div class="col-lg-11">
                <div class="form-group">
                  <input type="text" placeholder="Correo Electronico" class="form-control" name="email2" [(ngModel)]="email2" maxlength="100"
                    #emailref="ngModel" pattern="[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[a-z]{2,3}$">
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-1">
                <i class="fas fa-phone text-warning fa-2x float-right"></i>
              </div>
              <div class="col-lg-11">
                <div class="form-group">
                  <input type="text" placeholder="movil" class="form-control" name="mobile2" [(ngModel)]="mobile2" maxlength="100" #mobileref="ngModel"
                    pattern="[0-9]{10,14}$">
                </div>
              </div>
            </div>


            <div class="row mb-3">
              <div class="col-lg-1">
                <i class="fas fa-key text-warning fa-2x float-right"></i>
              </div>

              <div class="col-lg-11">
                <div class="form-group">
                  <input type="text" placeholder="Contraseña" class="form-control" name="password2" [(ngModel)]="password2" maxlength="100"
                    #passwordref="ngModel" pattern="[A-Za-z0-9|°¬!'#$%&/()=?\¡¿´¨+*~`^,;.:-_@áéíóúÁÉÍÓÚ]{8,30}">
                </div>
              </div>
              <!--div class="col-lg-5">
              <div class="form-group">
                <input type="text" placeholder="Repetir contraseña" class="form-control">
              </div>
            </div-->
            </div>

            <!--div class="row">
            <div class="col-lg-1">
              <i class="fas fa-users text-warning fa-2x float-right"></i>
            </div>
            <div class="col-lg-11 mt-2">
              <div class="form-group">
                <h6>Tipo de usuario: </h6>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-lg-1"></div>
            <div class="col-lg-5 my-2">
              <div class="form-check form-check-inline">
                <input type="radio" class="form-check-input" name="us-opt" value="residente">
                <label class="form-check-label" for="res-opt">Residente</label>
              </div>
            </div>
            <div class="col-lg-5 my-2">
              <div class="form-check form-check-inline">
                <input type="radio" class="form-check-input" name="us-opt" value="proyectista">
                <label class="form-check-label" for="res-opt">Proyectista</label>
              </div>
            </div>
          </div-->

          </div>
        </div>
        <div class="modal-footer">
          <div [hidden]="!emailref.errors?.pattern">
            Correo Invalido.
          </div>
          <div [hidden]="!mobileref.errors?.pattern">
            El numero debe de tener minimo 10 y maximo 14 caracteres.
          </div>
          <div [hidden]="!passwordref.errors?.pattern">
            La contraseña debe de tener minimo 8 y maximo 30 caracteres, sin espacios.
          </div>
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancelar</button>
          <input [hidden]="emailref.errors?.pattern || mobileref.errors?.pattern ||  passwordref.errors?.pattern" type="submit" value="Editar" class="btn btn-warning">
          
        </div>

      </form>
    </div>
  </div>
</div>

<swal #updatecorrect title="Actualizado exitosamente" type="success" [focusCancel]="true"></swal>
<swal #updateincorrect title="Favor de completar todos los campos" type="warning" [focusCancel]="true"></swal>
<swal #delete title="Eliminado exitosamente" type="success" [focusCancel]="true"></swal>

